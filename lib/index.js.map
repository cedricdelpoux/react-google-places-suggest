{"version":3,"sources":["../src/index.js"],"names":["GooglePlacesSuggest","props","state","coordinate","googleMaps","focusedSuggestIndex","selectedLabel","suggests","handleKeyDown","bind","updateSuggests","search","nextProps","suggest","onSelectSuggest","geocodeSuggest","description","setState","suggestRadius","suggestTypes","suggestComponentRestrictions","autocompleteService","places","AutocompleteService","getPlacePredictions","input","location","LatLng","radius","types","componentRestrictions","googleSuggests","suggestLabel","callback","geocoder","Geocoder","geocode","address","results","status","GeocoderStatus","OK","geometry","latitude","lat","longitude","lng","title","e","length","key","handleSelectSuggest","focusSuggest","index","textNoResults","structured_formatting","firstMatchedString","main_text_matched_substrings","shift","labelParts","before","substr","offset","matched","after","renderSuggest","renderDefaultSuggest","map","renderNoResults","children","renderSuggests","propTypes","any","isRequired","object","func","string","number","array","defaultProps","country"],"mappings":"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","file":"index.js","sourcesContent":["import React, {\n  Component,\n  PropTypes\n} from \"react\"\n\nclass GooglePlacesSuggest extends Component {\n  constructor(props) {\n    super(props)\n\n    this.state = {\n      coordinate: null,\n      googleMaps: null,\n      focusedSuggestIndex: 0,\n      selectedLabel: props.selectedLabel,\n      suggests: [],\n    }\n\n    this.handleKeyDown = this.handleKeyDown.bind(this)\n  }\n\n  componentWillMount() {\n    this.updateSuggests(this.props.search)\n  }\n\n  componentWillReceiveProps(nextProps) {\n    this.updateSuggests(nextProps.search)\n  }\n\n  handleSelectSuggest(suggest) {\n    const {\n      onSelectSuggest\n    } = this.props\n\n    this.geocodeSuggest(suggest.description, () => {\n      this.setState({\n        selectedLabel: suggest.description,\n        suggests: []\n      }, () => {\n        onSelectSuggest(suggest, this.state.coordinate)\n      })\n    })\n  }\n\n  updateSuggests(search) {\n    const {\n      googleMaps,\n      suggestRadius,\n      suggestTypes,\n      suggestComponentRestrictions\n    } = this.props\n    const autocompleteService = new googleMaps.places.AutocompleteService()\n\n    if (!search) {\n      this.setState({\n        suggests: []\n      })\n      return\n    }\n\n    autocompleteService.getPlacePredictions({\n      input: search,\n      location: new googleMaps.LatLng(0, 0),\n      radius: suggestRadius,\n      types: suggestTypes,\n      componentRestrictions: suggestComponentRestrictions,\n    }, (googleSuggests) => {\n      if (!googleSuggests) {\n        this.setState({\n          suggests: []\n        })\n        return\n      }\n\n      this.setState({\n        focusedSuggestIndex: 0,\n        suggests: googleSuggests,\n      })\n    })\n  }\n\n  geocodeSuggest(suggestLabel, callback) {\n    const {\n      googleMaps\n    } = this.props\n    const geocoder = new googleMaps.Geocoder()\n\n    geocoder.geocode({\n      address: suggestLabel\n    }, (results, status) => {\n      if (status === googleMaps.GeocoderStatus.OK) {\n        const location = results[0].geometry.location\n        const coordinate = {\n          latitude: location.lat(),\n          longitude: location.lng(),\n          title: suggestLabel,\n        }\n\n        this.setState({\n          coordinate\n        }, callback)\n      }\n    })\n  }\n\n  handleKeyDown(e) {\n    const {\n      focusedSuggestIndex,\n      suggests\n    } = this.state\n\n    if (suggests.length > 0) {\n      if (e.key === \"Enter\") {\n        this.handleSelectSuggest(suggests[focusedSuggestIndex])\n      } else if (e.key === \"ArrowUp\") {\n        if (suggests.length > 0 && focusedSuggestIndex > 0) {\n          this.focusSuggest(focusedSuggestIndex - 1)\n        }\n      } else if (e.key === \"ArrowDown\") {\n        if (suggests.length > 0 && focusedSuggestIndex < suggests.length - 1) {\n          this.focusSuggest(focusedSuggestIndex + 1)\n        }\n      }\n    }\n  }\n\n  focusSuggest(index) {\n    this.setState({\n      focusedSuggestIndex: index\n    })\n  }\n\n  renderNoResults() {\n    const {\n      textNoResults\n    } = this.props\n\n    if (textNoResults === null) {\n      return;\n    }\n\n    return (\n      <li className=\"placesSuggest_suggest\">\n        {textNoResults}\n      </li>\n    )\n  }\n\n  renderDefaultSuggest(suggest) {\n    const {\n      description,\n      structured_formatting\n    } = suggest\n    const firstMatchedString = structured_formatting.main_text_matched_substrings.shift()\n    let labelParts = null\n\n    if (firstMatchedString) {\n      labelParts = {\n        before: description.substr(0, firstMatchedString.offset),\n        matched: description.substr(firstMatchedString.offset, firstMatchedString.length),\n        after: description.substr(firstMatchedString.offset + firstMatchedString.length),\n      }\n    }\n\n    return (\n      <div>\n        <span className=\"placesSuggest_suggestLabel\">\n          {labelParts\n            ? <span>\n                {labelParts.before.length > 0 ? <span>{labelParts.before}</span> : null}\n                <span className=\"placesSuggest_suggestMatch\">{labelParts.matched}</span>\n                {labelParts.after.length > 0 ? <span>{labelParts.after}</span> : null}\n              </span>\n            : description\n          }\n        </span>\n      </div>\n    )\n  }\n\n  renderSuggest(suggest) {\n    const {\n      renderSuggest\n    } = this.props\n    return renderSuggest ? this.renderSuggest(suggest) : this.renderDefaultSuggest(suggest)\n  }\n\n  renderSuggests() {\n    const {\n      focusedSuggestIndex,\n      suggests\n    } = this.state\n    return (\n      <ul className=\"placesSuggest_suggests\">\n        {suggests.length > 0\n          ? suggests.map((suggest, key) => (\n            <li\n              key={key}\n              className={`placesSuggest_suggest ${focusedSuggestIndex === key && \"placesSuggest_suggest-active\"}`}\n              onClick={() => this.handleSelectSuggest(suggest)}\n            >\n              {this.renderSuggest(suggest)}\n            </li>\n          ))\n          : this.renderNoResults()\n        }\n      </ul>\n    )\n  }\n\n  render() {\n    const {\n      selectedLabel\n    } = this.state\n    const {\n      children,\n      search\n    } = this.props\n    return (\n      <div className=\"placesSuggest\" onKeyDown={this.handleKeyDown}>\n        {children}\n        {search && selectedLabel !== search && this.renderSuggests()}\n      </div>\n    )\n  }\n}\n\nGooglePlacesSuggest.propTypes = {\n  children: PropTypes.any.isRequired,\n  googleMaps: PropTypes.object.isRequired,\n  onSelectSuggest: PropTypes.func,\n  renderSuggest: PropTypes.func,\n  search: PropTypes.string,\n  suggestRadius: PropTypes.number,\n  suggestTypes: PropTypes.array,\n  suggestComponentRestrictions: PropTypes.object,\n  textNoResults: PropTypes.string,\n}\n\nGooglePlacesSuggest.defaultProps = {\n  onSelectSuggest: () => {},\n  search: \"\",\n  selectedLabel: '',\n  suggestRadius: 20,\n  suggestTypes: [],\n  suggestComponentRestrictions: {\n    country: \"\"\n  },\n  textNoResults: \"No results\",\n}\n\nexport default GooglePlacesSuggest"]}